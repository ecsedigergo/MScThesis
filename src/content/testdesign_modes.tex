%----------------------------------------------------------------------------
\chapter{Test Documentation for MoDeS$^3$ project}\label{TestDoc:MODES}
%----------------------------------------------------------------------------

\section{Test Policy for MoDeS$^3$ organization}
\paragraph{Scope:} The following Test Policy must be followed by the MoDeS$^3$ team in the Department of Measurement and Information Systems.
\paragraph{Introduction:} The railway system project have started several years back, and from time to time the team faced smaller and bigger problems with the implemented product. Presumably a high percentage of them could be prevented with a detailed test documentation and process. To avoid these situations in the future I will now introduce a test documentation approach for the demonstrator railway system.
\paragraph{Objectives of testing:} The objective of testing is to measure and improve the software quality and to avoid safety-critical failures in the system.
\paragraph{Standards:} This test documentation will follow the ISO/IEC/IEEE standard 291119-3 "Test Documentation" part \cite{IEEE13}.
\paragraph{Test improvement:} Every student or a group of them who participated in the test implementation should give an overview about the test results and their execution aligned with the test documentation approach. Any further developed component should be covered by test cases with the corresponding test documentation. Consequently the requirements, the test plan sub-processes (unit, integration and system test plans) and the design specifications must be extended to cover the newly attached or modified components.
\paragraph{Test evaluation:} Each extension should be handled as a github pull request, which must be reviewed by 2 of the team members and additionally must be checked by the student's supervisor.

\section{Test Strategy for MoDeS$^3$ projects}
\paragraph{Scope:} The following test strategy is applicable for the demonstrator railway system project (described in \autoref{chapter:RailwaySystem}). This strategy's aim is to support testing implementation and maintainability at the software development phases in component, integration and system level also.
\paragraph{Risk management:} A risk management must be handled for test plans separately. The detailed format must be a traceable list or table.
\paragraph{Test selection prioritization:} The test cases and test procedures will follow a bottom-up strategy order, aligned with safety-critical risk levels. Consequently a test element with lower dependencies and more independent functionalities (also more hardware related) got higher priority than a complex test element, which relies on multiple sub components.
\paragraph{Test document and reporting:} The test process and documentation must be well-separated and clear that a new team member can easily understand the structure.
\paragraph{Test automation and tools:} All tools, which is used during the test process and documentation must be available for a university student (meaning education license or freeware).
\paragraph{Incident management:} All detected defects must be created as a github issue. \footnote{MoDeS$^3$ github page is available at the following page: \url{https://github.com/FTSRG/BME-MODES3}}
\paragraph{Test sub-processes:} All test projects must provide the following test levels: unit test plan, integration test plan, system test plan.

\section{Test Completion Report}
\todo[inline]{do i need it right there? test status is more suitable in this thesis}

\section{Master Test Plan for Railway System project}\label{section:MTP}
\paragraph{Scope:} Test plan's scope is to provide the necessary test framework for executing tests for the demonstrator railway system of MoDeS$^3$ team. This document identifies a way for planning, executing and maintaining tests in a multi-layered project.
\paragraph{Plan context:} The railway system architecture (detailed in \autoref{chapter:RailwaySystem}) consist of off-the-shelf and custom hardware and software elements. According to this, the \textit{test items} are only the custom software elements, which were made by the MoDeS$^3$ team. Details about test items can be found in \autoref{section:CustomSW}. Other product testing and the custom hardware extension verifications are not part of this Test Documentation. Furthermore not all the software component have been involved in this testing plan, because not safety critical components have been skipped. \textit{Barrier} is irrelevant regarding the train-collision detection. An additional way to set the speed and directions of the trains is not safety critical either, so \textit{LeapMotion} and \textit{XPressNet} components are not safety critical (Note that an other components are capable to detect train positions on the railway). \textit{Touchboard} is a component which have a reduced functionality considered to \textit{Dashboard}, so we will skip that also in this test plan.
\paragraph{Risk register:} On the following 2 tables the possible product (\autoref{table:Product-risks}) and project risks (\autoref{table:Project-risks}) are described. The following assessment will cover the risk management for all the test sub-plans in the MoDeS$^3$ project.

\begin{table}[!h]
\caption{Product risks}
\label{table:Product-risks}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{ X[0.1, c] X[0.5, l] X[l] X[0.4, l] }
			\toprule
			ID & Risk details                            & Mitigation activities                                                                  & Level        \\ \midrule
			                                                      \multicolumn{4}{c}{Occupancy detection}                                                        \\
			1  & Wrong or no occupancy detected          & Review of appropriate hardware and software elements considering network connection    & High         \\
			                                                   \multicolumn{4}{c}{Track element controlling}                                                     \\
			2  & Not controllable turnout or segment     & Review of hardware and software components considering standard railway elements also. & Above middle \\
			                                                  \multicolumn{4}{c}{Safety critical verification}                                                   \\
			3  & Wrong collision avoidance decision made & Review of design and safety algorithm. Extra test cases to cover incorrect scenarios   & High         \\
			4  & Train collision                         & Review of design and safety algorithm.                                                 & High         \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\begin{table}[!h]
	\caption{Project risks}
	\label{table:Project-risks}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{ X[0.1, c] X[0.5, l] X[l] X[0.4, l] }
			\toprule
			ID & Risk                         & Mitigation activities                                                                                                                                                                                             & Level  \\ \midrule
			1  & Busy students and estimation & For a student every semester is different and not always predictable how much time will the student have for the project. Therefore it must be consider during project estimation and planning accordingly.       & Middle \\
			2  & New students and planning    & This is a university project, so we must calculate with the often changing student and knowledge transfer about the existing system.                                                                              & High   \\
			3  & Cutting-edge tools           & Unpredictable cutting-edge technologies can make a huge rule during project planning. The compatibility of tools and their reliability can differ during few month also, which must be adapted during estimation. & Above middle   \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\paragraph{Test strategy:} 
For the railway system project, the following test sub-processes are defined:
\begin{itemize}
	\item Unit test (see in \autoref{ssection:UTP})
	\item Integration test (see in \autoref{ssection:ITP})
	\item System test (see in \autoref{ssection:STP})
\end{itemize}
\todo[inline]{verify them for all sub-processes}
In addition for all sub-processes the following documents must be delivered:
\begin{itemize}
	\item Test sub-process plan
	\item Test specification
	\item Test log
	\item Test sub-process completion or status report
\end{itemize}
The test design techniques, test completion criteria and test data must be applied accordingly for every test sub-process. We use the following test environments in general:
\begin{itemize}
	\item Eclipse Photon where applicable
	\item Visual Studio Code where applicable
	\item JUnit Jupiter for Java base components
	\item Mockito with PowerMockito for components written in Java
	\item GTest for components written in C++
	\item Railway track elements
\end{itemize}
\paragraph{Test activities and estimates:} These are confirmed personally and aligned with university studies.
\paragraph{Stuffing:} The actual team and roles are highly dependent with the MoDeS$^3$ team in every semester.
\paragraph{Retesting and regression testing:} This is specified for each test sub-process. \todo[inline]{Do not forget!}

\subsection{Unit Test Plan}\label{ssection:UTP}
\paragraph{Scope:} The aim for this Test Plan is to verify each software component's functionality in the system. This plan is derived from a Master Test Plan (detailed the \autoref{section:MTP} for Master Test Plan). 
\paragraph{Plan context:} Unit Test Plan context is the same as for Master Test Plan (see \autoref{section:MTP}), because all self developed software component must be tested in a standalone environment also. 
\paragraph{Risk register:} Same as Master Test Plan.
\paragraph{Test strategy:} The deliverables are this test plan, the test specification for unit test and the test status report. Each unit must reach a 80\%  requirement coverage. 
%\paragraph{Test activities and estimates:}
\todo[inline]{During the test process and documentation the decision coverage and fault attack test design techniques are relevant. ? }

\todo[inline]{Complete test design techniques, test activities?}

\subsection{Integration Test Plan}\label{ssection:ITP}
\paragraph{Scope:} This test plan is stands for the integration level testing examination. This approach is one abstraction layer, above from the unit tests. Therefore the following test cases verifies the correct functionalities between one or more components. This test plan is also derived from a Master Test Plan (detailed the \autoref{section:MTP} for Master Test Plan).
\paragraph{Plan context:} In this plan we aim to test the system divided into several groups, consequently the Integration Test Plan's context is the same as for Master Test Plan (see \autoref{section:MTP}) and for Unit Test Plan.
\paragraph{Risk register:} Same as Master Test Plan.
\paragraph{Test strategy:} The deliverables are this test plan, the test specification for integration test and the test status report. 
\todo[inline]{What should be the test completion criteria and test activities?}
%\paragraph{Test activities and estimates:}

\todo[inline]{complete test design techniques, test activities?}

\subsection{System Test Plan}\label{ssection:STP}
%Mainly the manual (hand-made) tests before a demo
\paragraph{Scope:} The third test plan is designed to test the demonstrator functions at system level. These tests are verifies the system's commonly demonstrated features. This test plan is also derived from a Master Test Plan (detailed the \autoref{section:MTP} for Master Test Plan). 
\paragraph{Plan context:} This plan's focus is the whole railway system, therefore the context is the same as for Master Test Plan (see \autoref{section:MTP}).
\paragraph{Risk register:} Same as Master Test Plan.
\paragraph{Test strategy:} The deliverables are this test plan, the test specification for system test and the test status report. All test cases must be passed before each system demonstration.
%\paragraph{Test activities and estimates:}


\section{Test Design Specification for Unit Test Plan}

\paragraph{Purpose:} The purpose of this test specification is to give a guideline for executing unit tests for the demonstrator railway system components.
\paragraph{References:} The railway system related requirements can be found in \autoref{section:REQ}.

\subsection{Feature Sets} We can easily separate the system's functionalities into feature sets following the referenced system requirement's structure, which are shown in \autoref{table:Feature-Sets-Unit}.
\begin{table}[H]
\caption{Feature sets}
\label{table:Feature-Sets-Unit}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 1.0 \textwidth
			{  X[0.7,c] X[2.0, c] X[3.0, c] X[0.5,c] X[2.0, c] X[2.0, c] }
			\toprule
			\multicolumn{2}{c}{Feature Set} & Scope                                                                                             & Priority & Approach                       & Traceability                                                                   \\ \midrule
			ID   & Name                     &                                                                                                   &          &                                &                                                                                \\ \midrule
			FS-1 & GPIO handling            & To test GPIO pin handling                                                                         & Am       & Equivalence Class Partitioning & \ref{req:GPIO-1}, \ref{req:GPIO-2}                                             \\
			FS-2 & Occupancy detection      & To test the occupancy related functionalities in the system, including state and change detection & H        & Decision Table Testing         & \ref{req:OCQ-1}, \ref{req:OCQ-2}, \ref{req:SOQ}                                \\
			FS-3 & Track element controller & To test segment availability and turnout direction setting                                        & Am       & Equivalence Class Partitioning & \ref{req:TEC-1}, \ref{req:TEC-2}                                               \\
			FS-4 & Safety Logic             & To test railway system's safety logic                                                             & H        & Use Case Testing               & \ref{req:SL-1}, \ref{req:SL-2} , \ref{req:SL-3}, \ref{req:SL-4}                \\
			FS-5 & Dashboard                & To test Dashboard capabilities                                                                    & L        & Use Case Testing               & \ref{req:DB-1}, \ref{req:DB-2}, \ref{req:DB-3}, \ref{req:DB-4}, \ref{req:DB-5} \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\subsection{Test Conditions} In the following section I will describe the test conditions for each feature set. Most of the feature sets in the Unit Test Plan are simple low level functions so the test conditions also will describe the test coverage items.

\paragraph{GPIO handling (FS-1)}
Considering the GPIO's functionality the following test conditions are test coverage items also (see \autoref{table:TC-FS-1}).
\begin{table}[H]
	\caption{GPIO handling test condition and coverage items}
	\label{table:TC-FS-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[c] X[c] X[c] X[c] X[c] }
			\toprule
			Test condition & Direction                     & Phase                            & Configuration file           & Setting \\ \midrule
			FS-1/1.0       & \centeredDoubleRow{3}{Input}  & Initialization                   & edge                         & both    \\
			FS-1/1.1       &                               & \centeredDoubleRow{2}{Operation} & \centeredDoubleRow{2}{value} & low    \\
			FS-1/1.2       &                               &                                  &                              & high    \\
			FS-1/2.0       & \centeredDoubleRow{2}{Output} & Initialization                   & \centeredDoubleRow{3}{value} & low     \\
			FS-1/2.1       &                               & \centeredDoubleRow{2}{Operation} &                              & low     \\
			FS-1/2.2       &                               &                                  &                              & high    \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\paragraph{Occupancy detection (FS-2)}
The 2 test condition items are also considered as test coverage items, which are shown in \autoref{table:TC-FS-2}). The values are observed as the periodic occupancy detection result for one section.
\begin{table}[H]
	\caption{Occupancy detection test condition and coverage items}
	\label{table:TC-FS-2}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[c] X[c] X[c] }
			\toprule
			Test condition & Value    & Comment             \\ \midrule
			FS-2/1.0       & Free     & Specific segment is free     \\
			FS-2/1.1       & Occupied & Specific segment is occupied \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}


\paragraph{Track element controller (FS-3)}
A track element controller can handle segment and turnout specific statements also, consequently we must distinguish our test condition and coverage items for these segment types. The merged test condition and coverage items are shown in \autoref{table:TC-FS-3}.
\begin{table}[H]
	\caption{Track element controller test condition and coverage items}
	\label{table:TC-FS-3}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[c] X[c] X[c] }
			\toprule
			Test condition & Affected element               & State     \\ \midrule
			FS-3/1.0       & \centeredDoubleRow{2}{Segment} & Enabled   \\
			FS-3/1.1       &                                & Disabled  \\
			FS-3/2.0       & \centeredDoubleRow{2}{Turnout} & Straight  \\
			FS-3/2.1       &                                & Divergent \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\paragraph{Safety Logic (FS-4)}
The safety-critical aspects are shown in \autoref{table:TC-FS-4}, which should be handled by the Safety Logic.
\begin{table}[H]
	\caption{Safety Logic test condition items}
	\label{table:TC-FS-4}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[c] X[c] X[c] }
			\toprule
			Test condition & Safety Level                  & Safety type     \\ \midrule
			FS-4/1.0       & \centeredDoubleRow{2}{System} & Train collision \\
			FS-4/2.0       &                               & Turnout derail  \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\paragraph{Dashboard (FS-5)}
A full use case coverage is aimed for the Dashboard which can be defined by the following test condition and coverage items, shown in \autoref{table:TC-FS-5}.
\begin{table}[H]
	\caption{Dashboard test conditions}
	\label{table:TC-FS-5}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[c] X[c] X[c] X[c] }
			\toprule
			Test condition & Scope                       & Section type                   & State     \\ \midrule
			FS-5/1.0       & \centeredDoubleRow{4}{All}  & \centeredDoubleRow{2}{Turnout} & Straight  \\
			FS-5/1.1       &                             &                                & Divergent \\
			FS-5/1.2       &                             & \centeredDoubleRow{2}{Segment} & Enabled   \\
			FS-5/1.3       &                             &                                & Disabled  \\
			FS-5/2.0       & \centeredDoubleRow{4}{Each} & \centeredDoubleRow{2}{Turnout} & Straight  \\
			FS-5/2.1       &                             &                                & Divergent \\
			FS-5/2.2       &                             & \centeredDoubleRow{2}{Segment} & Enabled   \\
			FS-5/2.3       &                             &                                & Disabled  \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\subsection{Test coverage items}

\todo[inline]{Do I have to mention that these are the same for the other FSs?}
\todo[inline]{create diagrams for each test coverage item}
\paragraph{Safety Logic: Train collision test coverage items (FS-4/1.0)}
\begin{enumerate}[label=FS-5/1.0-\arabic*, leftmargin=*, format=\small]
	\item 1 Train is moving to a segment where there is an other train
	\item 1 Train is moving to a segment where the other train is 1 distance away on the path
	\item 1 Train is moving to a segment where the other train is 2 distance away on the path
\end{enumerate}
\paragraph{Safety Logic: Turnout derail test coverage items (FS-4/2.0)}
\begin{enumerate}[label=FS-5/2.0-\arabic*, leftmargin=*, format=\small]
	\item Train is moving through a turnout from top to divergent, while the turnout is in straight state
	\item Train is moving through a turnout from top to straight, while the turnout is in divergent state
\end{enumerate}

\subsection{Test cases}\label{section:UnitTestCases}
In this section I will describe the test cases defined by test conditions and coverage items for each feature set. In addition for all the feature sets just one test case will be mentioned and all the other test cases can be found in the \ref{appendix:UnitTC} appendix.
\paragraph{Gpio Handling (FS-1) test cases} In order to work in production with GPIO component, the following configuration file must exists: sys/gpio/gpioPIN/export, sys/gpio/gpioPIN/value and sys/gpio/gpioPIN/edge. This need is also propagate to all test cases regarding GPIO handling, so files must be accessible or mocked. 
\begin{table}[H]
	\caption{Test case 1-1}
	\label{table:TCase-FS1-01}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 1-1 \newline Priority: am \newline Tracing: FS-1/1.0 & Purpose: to test the GPIO initialization in input direction.       \\ \midrule
			Precondition                                                       & The GPIO's necessary files are available.                          \\
			Input                                                              & Initialize the GPIO itself with input direction.                  \\
			Expected result                                                    & The "both" string have been written to "edge" configuration file. \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\paragraph{Occupancy detection (FS-2) test cases} Occupancy detection components cannot be easily separated into subcomponents for testing purpose, because the communication between their parts is based on a serial port connection. There is no fake serial port connection  available on the market for windows operating system, so we must test them together with real hardware connection or modify our implementation.

\begin{table}[H]
	\caption{Test case 2-1}
	\label{table:TCase-FS2-01}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 2-1 & Purpose: to test the detection of segment occupancy (the train power consumption) through section occupancy query, when the specific segment is free\newline Priority: above middle \newline Tracing: (FS-2/1.0) \\ \midrule
			Precondition      & S88 serial port connection and available Arduino hardware element                                                                                                                                                \\
			Input             & Unclosed circuit between the specific segment's hardware elements elements                                                                                                                                       \\
			Expected result   & Occupancy components have queried free occupancy state                                                                                                                                                           \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\paragraph{Track element controller (FS-3)  test cases} This component can further be divided into segment and turnout controllers. In this test plan, it does not detailed into further test cases for the specific controllers, because all the functional responsibility can be tested separately for each of them.

\begin{table}[H]
	\caption{Test case 3-1}
	\label{table:TCase-FS3-01}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 3-1 & Purpose: to test the track element controller's segment state setting as enabled \newline Priority: above middle \newline Tracing: (FS-3/1.0) \\ \midrule
			Precondition      & Observable GPIO components                                                                                                                    \\
			Input             & Call the track element controller set segment state function with enabled parameter                                                           \\
			Expected result   & All GPIO levels are in "HIGH" state, which are related to the specific segment                                                                \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\paragraph{Safety logic (FS-4) test cases} The following test cases are related to System level safety logic feature set.
\todo[inline]{extend it with figures?}
\begin{table}[H]
	\caption{Test case 4-1}
	\label{table:TCase-FS4-01}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 4-1 & Purpose: to test the safety logic awareness, when a train is moving on a path where the next section in the direction already occupied by an other train \newline Priority: high \newline Tracing: (FS-4/1.0) \\ \midrule
			Precondition      & None                                                                                                                                                                                                          \\
			Input             & Insert a train to a specific segment and move an other train to the adjacent segment                                                                                                                          \\
			Expected result   & Safety Logic sent a segment disable command with the id of the specific segment                                                                                                                               \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\paragraph{Dashboard (FS-5) test cases} The following test cases are Dashboard feature set related items. This component can control and visualize the current track element states, consequently the unit test cases are checking the control network messages.
\begin{table}[H]
	\caption{Test case 5-1}
	\label{table:TCase-FS5-01}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 5-1 \newline Priority: am \newline Tracing: FS-5/1.0 & Purpose: to test the dashboard's set all turnout to straight functionality                   \\ \midrule
			Precondition                                                                   & All turnout must be in divergent state                                                       \\
			Input                                                                          & Simulate a button press to the change all turnout direction function                         \\
			Expected result                                                                & Message have been prepared to send with straight and a turnout id parameter for all turnouts \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}


\subsection{Test Procedure Specification}
In this Unit Test Plan, each feature set is derived from a custom software component in the demonstrator railway system. Regarding this property each test set can involve a group of test cases which are related for that feature set. A unit test must be a fast, isolated, repeatable, self-validated execution, therefore test set's ordering should not influence the test results. Consequently we can execute them independently and parallel but we can also give an order as the test cases ordered in the Test case definition section (described in \autoref{section:UnitTestCases}) and one test procedure can contain one test set. 

\todo[inline]{Create tables for 5 test procedures, which lists the test cases grouped by components -> table with columns: test case name | actual results | test result?}


\section{Test Design Specification for Integration Test Plan}

\paragraph{Purpose:} The aim of the following test specification is to give instructions about setting up and executing integration tests. These tests will verify two or more component's behavior together.
\paragraph{References:} The railway system related requirements can be found in \autoref{section:REQ}.

\subsection{Feature Sets} 
In the (\ref{table:Feature-Sets-integration}) table the components of the demonstrator railway system are grouped into integration feature sets separated by functional purposes.
\begin{table}[H]
	\caption{Feature sets for Integration Test Plan}
	\label{table:Feature-Sets-integration}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 1.0 \textwidth
			{  X[0.7,c] X[1.5, c] X[3.0, c] X[0.7,c] X[c] X[2.0,c] }
			\toprule
			       \multicolumn{2}{c}{Feature Set}        & Scope                                                                                                        & Priority & Approach & Traceability                                                                                                  \\ \midrule
			ID    & Name                                  &                                                                                                              &          &          &                                                                                                               \\ \midrule
			FSI-1 & Occupancy message                     & To test the occupancy network messages sent out by the occupancy components                                  & Am       &          & \ref{req:OCQ-1}, \ref{req:OCQ-2}, \ref{req:SOQ}                                                               \\
			FSI-2 & Track element controller instructions & To test Track element controller and GPIO handling functionalities, manipulating by network command messages & Am       &          & \ref{req:TEC-1} \ref{req:TEC-2} \ref{req:GPIO-1} \ref{req:GPIO-2}                                                                \\
			FSI-3 & Safety logic interaction              & To test the occupancy detections with safety logic reactions and their network command messages              & H        &          & \ref{req:SL-1} \ref{req:SL-2}  \ref{req:SL-3}  \ref{req:SL-4} \ref{req:OCQ-1}, \ref{req:OCQ-2}, \ref{req:SOQ} \\
			FSI-4 & Safety logic intervention             & To test the safety logic intervention through Track element controller by network command messages           & H        &          & \ref{req:SL-1} \ref{req:SL-2}  \ref{req:SL-3}  \ref{req:SL-4} \ref{req:TEC-1} \ref{req:TEC-2}                 \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\todo[inline]{Do I need FSI-3 and FSI-4 feature sets? (both?)}

\subsection{Test Conditions and coverage items}
The test condition and coverage items for the integration tests can be defined with the same aspects as the specific component in the unit test plan.
The following enumeration is showing a mapping between the integration and unit test feature sets.
\begin{enumerate}
	\item Occupancy message (FSI-1) - Occupancy detection (FS-3) (\ref{table:TC-FS-2})
	\item Track element controller instructions (FSI-2) - Track element controller(\ref{table:TC-FS-3})
	\item Safety Logic interaction (FSI-3) - Occupancy detection (FS-3) (\ref{table:TC-FS-2})
	\item Safety logic intervention (FSI-4) - Safety Logic (FS-4) (\ref{table:TC-FS-4})
\end{enumerate}
\todo[inline]{Make sure this enumeration isn't cutted into 2 half}
\todo[inline]{do we lost now traceability from test cases to test condition and coverage items ?} 

\subsection{Test cases}
\paragraph{Occupancy message (FSI-1) text cases} The occupancy related test cases are verifying the network message sent by the Occupancy Query software element.
\begin{table}[H]
	\caption{Integration test case 1-1}
	\label{table:TCase-FSI1-01}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 1-1 \newline Priority: am \newline Tracing: FS-2/1.0 & Purpose: to test the detection of segment occupancy when a segment is free and to verify the propagated network occupancy message \\ \midrule
			Precondition                                                                   & There must be an MQTT server connection available and an connected with serial port                                               \\
			Input                                                                          & Unclosed circuit between the specific segment's hardware elements                                                                 \\
			Expected result                                                                & A new segment occupancy message must be send to the network with free segment state  and the specific segment id                          \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 


\paragraph{Track element controller instructions (FSI-2) test cases}\label{p:TEC-ITC} The main focus in the following test cases is to send segment and turnout command messages to the Track element controller. We can further observer the file output for the supervised GPIOs.
\todo[inline]{should these testcases be concrete for a segment? }
\begin{table}[H]
	\caption{Integration test case 2-1}
	\label{table:TCase-FSI2-01}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 2-1 \newline Priority: am \newline Tracing: FS-3/1.0 & Purpose: to test the track element controller, that it enables its supervised segment's state                                   \\ \midrule
			Precondition                                                                   & There must be an MQTT server connection available                                                                               \\
			Input                                                                          & Send a SegmentCommand message with enabled state and a segment id which is supervised by the track element controller component \\
			Expected result                                                                & All related GPIO (pru and app) has the writer with value "1" and targetFile "value"                                             \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 
\subsection{Test procedure} 
In the integration test plan all the FSI-1 feature set related test cases requires hardware components during test execution. Apart from that all other test cases are purely software component tests, therefore they can be executed separately.

\todo[inline]{table with columns: test case name | actual results | test result ?}


\section{Test Design Specification for System Test Plan}

\paragraph{Purpose:} The system test plan is describes a road map to verify the high-level requirements of the railway system.
\paragraph{References:} The related requirements are previously described in \autoref{section:REQ}.

\subsection{Feature Sets} 
%1) manual with dashboard: check segments and turnouts
%2) SL checks: change turnout so trains can collide, change turnout and cut it with a train

\begin{table}[!h]
	\caption{System feature sets}
	\label{table:Feature-Sets-System}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 1.0 \textwidth
			{  X[0.8, c] X[1.5, c] X[3.0, c] X[0.7,c] X[c] X[2.0,c] }
			\toprule
			        \multicolumn{2}{c}{Feature Set}         & Scope                                                        & Priority & Approach & Traceability                                                               \\ \midrule
			ID    & Name                                    &                                                              &          &          &                                                                            \\ \midrule
			FSS-1 & Track element availability verification & To test the railway system track element's proper operations & Am       &          & \ref{req:DB-1} \ref{req:DB-2} \ref{req:DB-3} \ref{req:DB-4} \ref{req:DB-5} \\
			FSS-2 & Safety logic verification               & To test the safety logic functionalities                     & H        &          & \ref{req:SL-1} \ref{req:SL-2} \ref{req:SL-3} \ref{req:SL-4}                \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\subsection{Test condition and coverage items}
From the previously described (\ref{table:Feature-Sets-System}) feature sets the test condition and coverage items can be derived, which are detailed in the following sections.
\paragraph{Track element availability verification (FSS-1)} The purpose of this test condition is to verify all segment and turnout availability with a fast functional test. 
\begin{table}[H]
	\caption{Train detection test conditions}
	\label{table:TC-FSS-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[c] X[c] X[c] }
			\toprule
			Test condition & Scope                      & Section type \\ \midrule
			FSS-1/1        & \centeredDoubleRow{2}{All} & Turnout      \\
			FSS-1/2        &                            & Segment      \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 
\paragraph{Safety logic verification (FSS-2)} The system level safety logic verification the test conditions are the same it was previously shown for unit tests in \autoref{table:TC-FS-4}. To summarize that, the conditions can be divided into turnout derail and train collision scenarios. 

\subsection{Test cases}
\paragraph{Track element availability verification (FSS-1)} The following test cases will use network segment and turnout command messages as previously described in \autoref{p:TEC-ITC} integration test case. 
\begin{table}[H]
	\caption{System test case 1-1}
	\label{table:TCase-FSS1-01}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			System test case ID: 1-1 \newline Priority: am \newline Tracing: FS-6/1.0 & Purpose: to test all turnout controllability                                    \\ \midrule
			Precondition                                                              & None                                                                            \\
			Input                                                                     & Send a switch turnout command to all turnouts twice                                \\
			Expected result                                                           & All turnout state have been changed to straight from divergent and the other way \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}


\paragraph{Safety logic verification (FSS-2)} The below detailed safety logic test cases instead of checking the whole table, will just verify the safety logic decisions in the most problematic scenarios. 
\todo[inline]{Mention good figures about the layout here}
\begin{table}[H]
	\caption{System test case 2-1}
	\label{table:TCase-FSS2-01}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			System test case ID: 2-1 \newline Priority: am \newline Tracing: FS-6/1.2??? & Purpose: to test the safety logic for turnout derail scenario                                      \\ \midrule
			Precondition                                                                 & Turnout T5, T1 is in straight state and a train is on the segment S13                              \\
			Input                                                                        & Move the train to segment S15 from segment S13 through the path of S13, S8, T5, S11, T1, S15.      \\
			Expected result                                                              & Before T1 turnout the whole railway system is disabled by the safety logic to avoid turnout derail \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\subsection{Test procedure} 
%1) STC 1-1, 1-2, 1-3
%2) STC 2-1, 2-2
\paragraph{System test procedure for FSS-1} The following procedure is focusing on verifying the track element controller functionalities. 
\begin{enumerate}
	\item Objective: FSS-1
	\item Priority: high
	\item Start up: all the track element controllers should be started properly
	\item Stop and wrap up: all track element controllers on the components must be stopped
\end{enumerate}
\begin{table}[H]
	\caption{System test procedure for FSS-1}
	\label{table:SystemTestProcedure-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[1.5, c] X[c] X[c] }
			\toprule
			Test case name           & Actual results & Test result \\ \midrule
			1-1: change all turnout  &                &             \\
			1-2: disable all segment &                &             \\
			1-3: enable all segment  &                &             \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\paragraph{System test procedure for FSS-2}  
\begin{enumerate}
	\item Objective: FSS-2
	\item Priority: high
	\item Start up: place 2 trains on the sections of S13 and S15
	\item Stop and wrap up: restart the disabled sections or the whole track
\end{enumerate}
\begin{table}[H]
\caption{System test procedure for FSS-2}
\label{table:SystemTestProcedure-2}
\begin{center}
	\renewcommand{\arraystretch}{1.8}
	\begin{tabu} 
		to 0.9 \textwidth
		{  X[1.5, c] X[c] X[c] }
		\toprule
		Test case name       & Actual results & Test result \\ \midrule
		2-1: turnout derail  &                &             \\
		2-2: train collision &                &             \\ \bottomrule
	\end{tabu}
\end{center}
\end{table}

\section{Test Status Report}

\todo[inline]{Describe Code coverage and test measures for GPIO Manager}

\todo[inline]{for all test plans should be created a test status report?}