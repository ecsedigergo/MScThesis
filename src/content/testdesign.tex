%----------------------------------------------------------------------------
\chapter{Test design and documentation}
%----------------------------------------------------------------------------
\section{Test design techniques}

\todo[inline]{Extend this section with other used test design techniques}

The MoDeS$^3$ is a multi-layered, safety-critical application, which consist of off-the-self and custom made components also. As a complex system it is crucial to have a well-designed testing process and documentation which helps determine any problem in the system. For this purpose in the following chapter I will examine the possible and most suitable test approaches with a detailed test documentation.

\begin{figure}[!h]
	\centering
	\includegraphics[width=150mm]{figures/testDesign/V_model.png}
	\caption{V-model}
	\label{fig:vModel}
\end{figure}

\subsection{V-model and testing levels}
Nowadays one of the most popular software development methodology is the V-model \cite{Vmodel} (shown on figure \ref{fig:vModel}), which defines four stages during the development and four verification steps accordingly (each step is shown with rectangles on the figure). In addition for making the development more effective for error-detection, there are four more steps defined for verifying our system's correctness, called test levels \cite{TestLevels} (shown with ellipses). While the development starts with an abstract \textbf{requirement analysis}, which declares the aim of our application, later on each step contains more detailed information. The second phase is about understanding the abstract user requirements and define the system's \textbf{functional specification} by the developers. During this phase our verification is based on \textbf{Model-in-the-Loop (MiL) testing}. The third phase contains all the low-level design and specific information about the application. From these design decisions, the \textbf{implementation} should be quite straight-forward or even it can be generated. During the \textbf{Software-in-the-Loop (SiL) testing}, the implementation will be verified for a subset of functionalities, which is depending on the system's purpose and requirements.
As of now our implementation is done and our design decisions are verified, we make sure with \textbf{unit tests} that our functions are serving their exact purposes. \textbf{Processor-in-the-Loop (PiL)} testing ensures that the computing processor at the bottom of the V-model works as expected. Then moving up in the V-model with \textbf{integration tests}, we are focusing on more abstract and complex components. In this phase we consider software and hardware elements also, completed with \textbf{Hardware-in-the-Loop (HiL)} testing. The last step is about verifying the complete system in real environment and check the high-level requirements.

\todo[inline]{give details about the used test design techniques}

\section{Test documentation}
During the test design phases of the MoDeS$^3$ I will follow a subset of the ISO 291119 standard \cite{IEEE13}.
First I will describe the documents in general, which will be later used in the MoDeS$^3$ test documentation process in section \autoref{TestDoc:MODES}. As of now the organizational and role details are irrelevant for this project, I will just give a short example for those. In the following sections, I will subtract the documentations into 3 phases, called Organizational, Test Management and Dynamic Test Documentation. 
\todo[inline]{redraw figure to something similar}
\begin{figure}[!h]
	\centering
	\includegraphics[width=150mm, keepaspectratio]{figures/testDesign/TestDoc.png}
	\caption{test Documentation Overview}
	\label{fig:TestDocOverview}
\end{figure}

\subsection{Organizational test documentation}
These general documents must be distributed organizational-wise and must be the same for every project within the organization. In according to this, during the test documentation the organization will be the MoDeS$^3$ team and the only project will be the above detailed railway system.

\paragraph{Test Policy}
Throughout the test development a Test Policy must contain the test principles and objectives for the whole organization. It clarifies what should be tested during development, but not how testing must be implemented. Furthermore it must define the provisions to be used for establishing, improving, maintaining and reviewing the test Policy.

\paragraph{Test Strategy}
A Test Strategy must define a proper guideline on how testing should be performed for all projects in the organization. In our case one Test Strategy is sufficient, but for an organization which have projects in different technical areas, can have a Test Strategy for each area. In latter case, the organization can define separate Test sub-processes to satisfy any special need for an area or project.

\todo[inline]{Do I need more details about test sub-processes?}

%\begin{enumerate}
%	\item Organizational Test Strategy
%	\begin{enumerate}
%		\item Introduction
%		\item General test strategy statements
%		\begin{enumerate}
%			\item Generic risk management
%			\item Test selection and prioritization
%			\item Test documentation and reporting
%			\item Test automation and tools
%			\item Configuration management of test work products
%			\item Incident management
%			\item Test sub-processes
%		\end{enumerate}
%	\end{enumerate}
%\end{enumerate}

\subsection{Test Management Documentation}
The Test Management Documentation is focusing on one project's planning and test evaluation. This group of documentation provides guidelines for Test Plan, Test Status Report and Test Completion Report.

\paragraph{Test Plan}
The collection of the test planning and test management documents is the Test Plan. It's scope be mapped to multiple projects, a single project or to sub-projects, where each Test Plan is dedicated for a sub-process (For example system test plan, integration software test plan, sub-system test plan, or unit software test plan). In a complex design structure it is advised to have a mapping tree document, which shows the relations between these Test Plans.

\paragraph{Test Status Report}
A report from the currently ongoing test process in a given reporting period is the Test Status Report. For example in an agile project it can be delivered at the end of the iteration. Although it is not necessarily a written document.

\paragraph{Test Completion Report}
As a summary of our test execution, a Test Completion Report can be provided for every test sub-process or for the whole project itself.

\subsection{Dynamic Test Documentation}
During the Dynamic Test Documentation phase the following documents are prepared:
\begin{itemize}
	\item Test Specification with sub-documents of:
	\begin{itemize}
		\item Test Design Specification
		\item Test Case Specification
		\item Test Procedure Specification
	\end{itemize}
	\item Test Data Requirements
	\item Test Environment Requirements
	\item Test Data Readiness Report
	\item Test Environment Readiness Report
	\item Test Execution Documentation with sub-documents of:
	\begin{itemize}
		\item Actual Result
		\item Test Results
		\item Test Execution Log
		\item Incident Report
	\end{itemize}
\end{itemize}
\todo[inline]{Figure of test docs hierarchy can be added here}

In the following sections, I will give a brief summary for each documentation.

\paragraph{Test Design Specification} \label{TestDoc:TDS}
The features and test conditions (derived from test basis) are collected in the Test Design Specification with the specific test cases and test procedures. These detailed test cases will be executed during testing process. 

Here we can create groups called \textit{feature sets} for those features which are connected together, then we can handle them independently.  A \textit{test condition} is aligned for each feature set and can be verified by a test case. Technically a test condition means a concrete state or representation of a feature. In addition on or more requirement can be referenced by a test case. In addition, to develop a more maintainable test document we must take care for the references from test cases to each requirement.

\paragraph{Test Case Specification}
One or more feature set with the defined test conditions and coverage items, constitutes a Test Case Specification.

\textit{Test coverage items} are obtained from a set of test conditions and specific test design technique. These items can be summarized in a list (describing test coverage items, test conditions and feature sets with proper priorities). From each test coverage item a \textit{Test case} can be derived, which verifies the correct implementation of a function. Regarding the possible number of test cases it can be collected into a list, table or database. Each test case should have a proper definition of dependencies. These are collected in \autoref{table:TestDoc:TestCases}.

\begin{table}[h]
	\caption{Details of a test case}
	\label{table:TestDoc:TestCases}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[c]  X[c] }
			\toprule
			Aspect                     & Description                                                                                                                                               \\ \midrule
			Priority                   & Defines the execution order and importance between test cases. Higher priority test cases should be examined earlier then lower priorities                \\
			Traceability               & Reference the parent test coverage, condition item and the feature requirement                                                                            \\
			Preconditions              & Describes special states that must exists to execute the test case (Can be other test cases also)                                                         \\
			Inputs                     & A specific action which sets the test item into a state, where the actual and expected results can be compared                                            \\
			Expected result            & Specifies the expected output and behavior (with tolerances) of the test item which was in the precondition state and was modified with the proper inputs \\
			Actual result, test result & A description of test item outputs and a comparison between actual and expected results                                                                   \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\paragraph{Test Procedure Specification}
Describes the precondition setup and test cases execution in the proper order with possible post evaluation activities.

Those test cases, which have the same purpose in the test item's property (for example precondition, test basis or even in the identified risk) can be collected into a \textit{Test set}. Typically this will reflect to one or more feature sets. For each \textit{Test set} the proper execution order is defined in the \textit{Test procedure} considering test case dependencies, preconditions, postconditions and other environment requirements.

\paragraph{Test Data Requirements}
Defines the required properties of the test data, which is used during test procedure execution. These requirements can be summarized with a list. In addition, this detailed test data requirements makes it more maintainable and traceable. 

\paragraph{Test Data Readiness Report} 
Gives a list of Test Data Requirements determining whether they are satisfied or not.

\paragraph{Test Environment Requirements}
Describes the required test environment properties, which are setting the test items into the expected test environment. These requirements can also be grouped by environment types like hardware, middleware, software, tools or security and may vary for each test case.

\paragraph{Test Environment Readiness Report}
Lists the fulfillment of Test Environment Requirements.

\paragraph{Actual Results}
After executing the selected test procedures, each test case's actual result (output state or behavior after the input actions) should be recorded. It may require full recording of the process with an automated tool also.

\paragraph{Test Result}
Determines if the actual results are corresponding to the expected results with the specified deviation or not. It is usually recorded as passed or failed, along with the actual results.

\paragraph{Test Execution Log}
Detailed documentation of one or more test procedure's execution. Can be represented in a list or table with measuring times and events of the test execution.

\paragraph{Test Incident Reporting}
If there is any deviation between the actual and expected results after each test procedure execution, we should create a dedicated Incident Report detailing the problems. These reports could contain a description of the problem with severity, date and possible risk information.


\section{Test Documentation for MoDeS$^3$ project}\label{TestDoc:MODES}
\todo[inline]{What about: test process (do we want to mention the ISO 29119-2 test processes?), organization test evaluation, test improvement sections?}

\subsection{Test Policy for MoDeS$^3$ organization}
\paragraph{Scope:} This Test Policy will be followed by the MoDeS$^3$ team in the Department of Measurement and Information Systems.
\paragraph{Introduction:} The railway system project have started several years back, and from time to time the team faced smaller and bigger problems with the implemented product. Presumably a high percentage of them could be prevented with a detailed test documentation and process. To avoid these situations in the future I will now introduce a test documentation approach.
\paragraph{Objectives of testing:} The objective of testing is to measure and improve the software quality and to avoid safety-critical failures in the system.
\paragraph{Standards:} This test documentation will follow the ISO/IEC/IEEE standard 291119-3 "Test Documentation" part \cite{IEEE13}.

\subsection{Test Strategy for MoDeS$^3$ projects}
\todo[inline]{strategy todos: scope? risk management? github clarification}
\todo[inline]{risk management must be handled separately for each test plan??}
\paragraph{Scope:} The following test strategy is applicable for the railway system project. This strategy's aim is to support testing in the software development phases in component, integration and system level also.
\paragraph{Risk management:} For each specific test plan the risk management must be handled separately. The detailed format must be a traceable list or table. 
\paragraph{Test selection prioritization:} The test cases and test procedures will follow a bottom-up strategy order aligned with safety-critical risk levels. Consequently a test element with lower dependencies and more independent functionality (also more hardware related) got higher priority then a complex test element, which rely on multiple sub components.
\paragraph{Test document and reporting:} The test process and documentation must be well-separated and clear that a new team member can easily understand the structure.
\paragraph{Test automation and tools:} All tools, which is used during the test process and documentation must be available for a university student (meaning education license or freeware).
\paragraph{Incident management:} All detected defects must be created as a github issue also.
\paragraph{Test sub-processes:} All test projects must provide the following test levels: unit test plan, integration test plan, system test plan.


\subsection{Test Completion Report}
\todo[inline]{fill out in connection with progress, Give status that GPIO tests implemented and system tests used by the team and make a conclusion of their usage }

\subsection{Master Test Plan for Railway System project}\label{section:MTP}
\todo[inline]{Verify Test envs? sub processes? risk man.? }
\paragraph{Scope:} Test plan's scope is to provide the necessary test framework for executing tests for the railway system of MoDeS$^3$ team. This document identifies a way for planning, executing and maintaining tests in a multi-layered project.
\paragraph{Plan context:} The railway system architecture (detailed in \autoref{chapter:RailwaySystem}) consist of off-the-shelf products, custom hardware and software elements. According to this, the \textit{test items} are only the custom software elements, which were made by the MoDeS$^3$ team. Details about test items can be found in \autoref{section:CustomSW}. Other product testing and the custom hardware extension verifications are not part of this Test Documentation. Furthermore not all the software component have been involved in this testing plan, because not safety critical components have been skipped. \textit{Barrier} is irrelevant regarding the train-collision detection. How the trains get speed and direction controls is not safety critical either, so \textit{LeapMotion} and \textit{XPressNet} components are not safety critical (Note that an other components are capable to detect train positions on the railway). \textit{Touchboard} is a component which have a reduced functionality considered to \textit{Dashboard}, so we will skip that also right now.
\paragraph{Risk register:}
For a railway system, the possible safety-critical aspects are detailed in \autoref{section:SC-Functionalities}. On the following 2 tables the possible product (\autoref{table:Product-risks}) and project risks (\autoref{table:Project-risks}) are described.
\todo[inline]{Define metrics for the risk tables}
\begin{table}[!h]
\caption{Product risks}
\label{table:Product-risks}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{ X[0.1, c] X[0.5, l] X[l] X[0.4, l] }
			\toprule
			ID & Risk details                            & Mitigation activities                                                                  & Level        \\ \midrule
			                                                      \multicolumn{4}{c}{Occupancy detection}                                                        \\
			1  & Wrong or no occupancy detected          & Review of appropriate hardware and software elements considering network connection    & High         \\
			                                                   \multicolumn{4}{c}{Track element controlling}                                                     \\
			2  & Not controllable turnout or segment     & Review of hardware and software components considering standard railway elements also. & Above middle \\
			                                                  \multicolumn{4}{c}{Safety critical verification}                                                   \\
			3  & Wrong collision avoidance decision made & Review of design and safety algorithm. Extra test cases to cover additional scenarios & High         \\
			4  & Train collision                         & Review of design and safety algorithm.                                                 & High         \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\begin{table}[!h]
	\caption{Project risks}
	\label{table:Project-risks}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{ X[0.1, c] X[0.5, l] X[l] X[0.4, l] }
			\toprule
			ID & Risk & Mitigation activities & Level \\ \midrule
			1 & Busy students and estimation & For a student every semester is different and not always predictable how much time will the student have for the project. Therefore it must be consider during project estimation and planning accordingly.     &  \\ 
			2 & New students and planning & This is a university project, so we must calculate with the often changing student and knowledge transfer about the existing system.& \\
			3 & Cutting-edge tools & Unpredictable cutting-edge technologies can make a huge rule during project planning. The compatibility of tools and their reliability can differ during few month also, which must be adapted during estimation. & \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\paragraph{Test strategy:} 
For the railway system project, the following test sub-processes can be defined:
\begin{itemize}
	\item Unit test
	\item Integration test
	\item System test
\end{itemize}
\todo[inline]{verify them for all sub-processes}
In addition for all sub-processes the following documents must be delivered:
\begin{itemize}
	\item Test sub-process plan
	\item Test specification
	\item Test log
	\item Test sub-process completion report
\end{itemize}
The test design techniques, test completion criteria and test data must be applied accordingly for every test sub-process. We use the following test environments in general:
\begin{itemize}
	\item Eclipse Photon where applicable
	\item Visual Studio Code where applicable
	\item JUnit Jupiter for Java base components
	\item Mockito with PowerMockito for Java base components
	\item GTest for C++ components
	\item Railway track elements
\end{itemize}
\paragraph{Test activities and estimates:} These are confirmed personally and aligned with university studies.
\paragraph{Stuffing:} The actual team and roles are highly dependent with the MoDeS$^3$ team in every semester.
\paragraph{Retesting and regression testing:} This is specified for each test sub-process. \todo[inline]{Do not forget!}



\subsection{Unit Test Plan}
\paragraph{Scope:} The aim for this Test Plan is to verify each software component's functionality in the system. This plan is derived from a Master Test Plan (detailed the \autoref{section:MTP} for Master Test Plan). 
\paragraph{Plan context:} Unit Test Plan context is the same as for Master Test Plan (see \autoref{section:MTP}), because all self developed software component must be tested in a standalone environment also. 
\paragraph{Risk register:} Same as Master Test Plan.
\paragraph{Test strategy:} The deliverables are this test plan, the test specification for unit test and the test completion report. 
During the test process and documentation the decision coverage and fault attack test design techniques are relevant.
Each unit must reach a 80\%  requirement coverage. 
%\paragraph{Test activities and estimates:}

\todo[inline]{Risks? link the test deliverables, complete test design techniques, test activities?}

\subsection{Integration Test Plan}
\paragraph{Scope:} This test plan is stands for the integration level testing examination. This approach is one abstraction layer, above from the unit tests. This must ensure the correct functionality between one or more components. This test plan is also derived from a Master Test Plan (detailed the \autoref{section:MTP} for Master Test Plan).
\paragraph{Plan context:} In this plan we aim to test the system divided to several group, consequently the Integration Test Plan's context is the same as for Master Test Plan (see \autoref{section:MTP}) and for Unit Test Plan.
\paragraph{Risk register:} Same as Master Test Plan.
\paragraph{Test strategy:} The deliverables are this test plan, the test specification for integration test and the test completion report. 
\todo[inline]{What should be the test completion criteria?}
%During the test process and documentation the decision coverage and fault attack test design techniques are relevant.
%Each unit must reach a 80\%  requirement coverage. 
%\paragraph{Test activities and estimates:}

\todo[inline]{Risks? link the test deliverables, complete test design techniques, test activities?}

\subsection{System Test Plan}
%Mainly the manual (hand-made) tests before a demo
\paragraph{Scope:} The third test plan is designed to test the functions at system level. This test plan is also derived from a Master Test Plan (detailed the \autoref{section:MTP} for Master Test Plan).
\paragraph{Plan context:} This plan's focus is the whole railway system, therefore the context is the same as for Master Test Plan (see \autoref{section:MTP}).
\paragraph{Risk register:} Same as Master Test Plan.
\paragraph{Test strategy:} The deliverables are this test plan, the test specification for system test and the test completion report.
\todo[inline]{What should be the test completion criteria?}
%During the test process and documentation the decision coverage and fault attack test design techniques are relevant.
%Each unit must reach a 80\%  requirement coverage. 
%\paragraph{Test activities and estimates:}






\subsection{Test Design Specification for Unit Test Plan}

\paragraph{Purpose:} The purpose of this test specification is to give a guideline for executing unit tests.
\paragraph{References:} The railway system related requirements can be found in \autoref{section:REQ}.

\subsubsection{Feature Sets} We can easily separate the system's functionalities into feature sets following the referenced system requirement's structure. Feature sets are shown in \autoref{table:Feature-Sets-Unit}.
\todo[inline]{fill out approach column}
\begin{table}[H]
\caption{Feature sets}
\label{table:Feature-Sets-Unit}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 1.0 \textwidth
			{  X[0.7,c] X[1.5, c] X[3.0, c] X[0.7,c] X[c] X[2.0,c] }
			\toprule
			\multicolumn{2}{c}{Feature Set} & Scope                                                                                             & Priority & Approach & Traceability                                                                   \\ \midrule
			ID   & Name                     &                                                                                                   &          &          &                                                                                \\ \midrule
			FS-1 & GPIO handling            & To test GPIO pin handling                                                                         & Am       &          & \ref{req:GPIO}                                                                 \\
			FS-2 & Occupancy detection      & To test the occupancy related functionalities in the system, including state and change detection & H        &          & \ref{req:OCQ-1}, \ref{req:OCQ-2}, \ref{req:SOQ}                                \\
			FS-3 & Track element controller & To test segment availability and turnout direction setting                                        & Am       &          & \ref{req:TEC-1}, \ref{req:TEC-2}                                               \\
			FS-4 & Safety Logic             & To test railway system's safety logic                                                             & H        &          & \ref{req:SL-1}, \ref{req:SL-2} , \ref{req:SL-3}, \ref{req:SL-4}                \\
			FS-5 & Dashboard                & To test Dashboard capabilities                                                                    & L        &          & \ref{req:DB-1}, \ref{req:DB-2}, \ref{req:DB-3}, \ref{req:DB-4}, \ref{req:DB-5} \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\subsubsection{Test Conditions} In the following section I will describe the test conditions for each feature set. In this test plan, most of the feature sets are quite simple and straight-forward functionalities, so the test conditions also will describe the test coverage items.

\paragraph{GPIO handling (FS-1)}
Considering the GPIO's functionality the following test conditions are test coverage items also (see \autoref{table:TC-FS-1}).
\begin{table}[H]
	\caption{GPIO handling test condition and coverage items}
	\label{table:TC-FS-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[c] X[c] X[c] X[c] X[c] }
			\toprule
			Test condition & Direction                     & Phase                            & Configuration file           & Setting \\ \midrule
			FS-1/1.0       & \centeredDoubleRow{3}{Input}  & Initialization                   & edge                         & both    \\
			FS-1/1.1       &                               & \centeredDoubleRow{2}{Operation} & \centeredDoubleRow{2}{value} & low    \\
			FS-1/1.2       &                               &                                  &                              & high    \\
			FS-1/2.0       & \centeredDoubleRow{2}{Output} & Initialization                   & \centeredDoubleRow{3}{value} & low     \\
			FS-1/2.1       &                               & \centeredDoubleRow{2}{Operation} &                              & low     \\
			FS-1/2.2       &                               &                                  &                              & high    \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\paragraph{Occupancy detection (FS-2)}
The 2 test condition items are also considered as test coverage items, which are shown in \autoref{table:TC-FS-2}). The values are observed as the periodic occupancy detection result for one section.
\begin{table}[H]
	\caption{Occupancy detection test condition and coverage items}
	\label{table:TC-FS-2}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[c] X[c] X[c] }
			\toprule
			Test condition & Value    & Comment             \\ \midrule
			FS-2/1.0       & Free     & Specific segment is free     \\
			FS-2/1.1       & Occupied & Specific segment is occupied \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}


\paragraph{Track element controller (FS-3)}
A track element controller can handle segment and turnout specific statements also, consequently we must distinguish our test condition and coverage items for these segment types. The merged test condition and coverga items are shown in \autoref{table:TC-FS-3}.
\begin{table}[H]
	\caption{Track element controller test condition and coverage items}
	\label{table:TC-FS-3}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[c] X[c] X[c] }
			\toprule
			Test condition & Affected element               & State     \\ \midrule
			FS-3/1.0       & \centeredDoubleRow{2}{Segment} & Enabled   \\
			FS-3/1.1       &                                & Disabled  \\
			FS-3/2.0       & \centeredDoubleRow{2}{Turnout} & Straight  \\
			FS-3/2.1       &                                & Divergent \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\paragraph{Safety Logic (FS-4)}
The safety-critical aspects are shown in \autoref{table:TC-FS-4}, which should be handled by the Safety Logic.
\begin{table}[H]
	\caption{Safety Logic test condition items}
	\label{table:TC-FS-4}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[c] X[c] X[c] }
			\toprule
			Test condition & Safety Level                  & Safety type     \\ \midrule
			FS-4/1.0       & \centeredDoubleRow{2}{System} & Train collision \\
			FS-4/2.0       &                               & Turnout derail  \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\paragraph{Dashboard (FS-5)}
A full functional coverage is aimed for the Dashboard which can be defined by the following test condition and coverage items, shown in \autoref{table:TC-FS-5}.
\begin{table}[H]
	\caption{Dashboard test conditions}
	\label{table:TC-FS-5}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[c] X[c] X[c] X[c] }
			\toprule
			Test condition & Scope                   & Section type                   & State     \\ \midrule
			FS-5/1.0       & \centeredDoubleRow{4}{All}  & \centeredDoubleRow{2}{Turnout} & Straight  \\
			FS-5/1.1       &                             &                                & Divergent \\
			FS-5/1.2       &                             & \centeredDoubleRow{2}{Segment} & Enabled   \\
			FS-5/1.3       &                             &                                & Disabled  \\
			FS-5/2.0       & \centeredDoubleRow{4}{Each} & \centeredDoubleRow{2}{Turnout} & Straight  \\
			FS-5/2.1       &                             &                                & Divergent \\
			FS-5/2.2       &                             & \centeredDoubleRow{2}{Segment} & Enabled   \\
			FS-5/2.3       &                             &                                & Disabled  \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\subsubsection{Test coverage items}

\todo[inline]{Do I have to mention that these are the same for the other FSs}
\todo[inline]{diagrams for each test coverage item}
\paragraph{Safety Logic: Train collision test coverage items (FS-4/1.0)}
\begin{enumerate}[label=FS-5/1.0-\arabic*, leftmargin=*, format=\small]
	\item 1 Train is moving to a segment where there is an other train
	\item 1 Train is moving to a segment where the other train is 1 distance away on the path
	\item 1 Train is moving to a segment where the other train is 2 distance away on the path
\end{enumerate}
\paragraph{Safety Logic: Turnout derail test coverage items (FS-4/2.0)}
\begin{enumerate}[label=FS-5/2.0-\arabic*, leftmargin=*, format=\small]
	\item Train is moving through a turnout from top to divergent, while the turnout is in straight state
	\item Train is moving through a turnout from top to straight, while the turnout is in divergent state
\end{enumerate}

\subsubsection{Test cases}\label{section:UnitTestCases}
In this section I will describe the test cases defined by test conditions and coverage items for each feature set.
\paragraph{Gpio Handling (FS-1) test cases} In order to work in production with GPIO component, the following configuration file must exists: sys/gpio/gpioPIN/export, sys/gpio/gpioPIN/value and sys/gpio/gpioPIN/edge. This need is also propagate to all test cases regarding GPIO handling, so files must be accessible or mocked.
\todo[inline]{priority for?}
\begin{table}[H]
	\caption{Test case 1-1}
	\label{table:TCase-FS1-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 1-1 \newline Priority: am \newline Tracing: FS-1/1.0 & Purpose: to test the GPIO initialization in input direction.       \\ \midrule
			Precondition                                                       & The GPIO's necessary files are available.                          \\
			Input                                                              & Initialize the GPIO itself with input direction.                  \\
			Expected result                                                    & The "both" string have been written to "edge" configuration file. \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\begin{table}[H]
	\caption{Test case 1-2}
	\label{table:TCase-FS1-2}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 1-2 \newline Priority: am \newline Tracing: FS-1/1.1 & Purpose: to test the GPIO pin input change listener while direction is input and the value is "0". \\ \midrule
			Precondition                                                       & The GPIO's necessary files are available.                                                          \\
			Input                                                              & The value file have been written to "0", considered as LOW.                                       \\
			Expected result                                                    & GPIO noticed the change and read the "value" configuration file content as LOW level.             \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\begin{table}[H]
	\caption{Test case 1-3}
	\label{table:TCase-FS1-3}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 1-3 \newline Priority: am \newline Tracing: FS-1/1.2 & Purpose: to test the GPIO pin change listener while direction is input and the value is "1". \\ \midrule
			Precondition                                                       & The GPIO's necessary files are available.                                                    \\
			Input                                                              & The value file have been written to "1" considered as HIGH.                                 \\
			Expected result                                                    & GPIO noticed the change and read the "value" configuration file content as HIGH level.      \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\begin{table}[H]
	\caption{Test case 1-4}
	\label{table:TCase-FS1-4}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 1-4 \newline Priority: am \newline Tracing: FS-1/2.0 & Purpose: to test the GPIO initialization in output direction.   \\ \midrule
			Precondition                                                       & The GPIO's necessary files are available.                        \\
			Input                                                              & Initialize the GPIO itself with output direction.               \\
			Expected result                                                    & The "0" string have been written to "value" configuration file. \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\begin{table}[H]
	\caption{Test case 1-5}
	\label{table:TCase-FS1-5}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 1-5\newline Priority: am \newline Tracing: FS-1/2.1 & Purpose: to test the GPIO pin's level setting to LOW. \\ \midrule
			Precondition                                                      & The GPIO's necessary files are available.            \\
			Input                                                             & Set the GPIO's level to LOW.                         \\
			Expected result                                                   & The "value" file has been modified with value "0"    \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\begin{table}[H]
	\caption{Test case 1-6}
	\label{table:TCase-FS1-6}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 1-6 \newline Priority: am \newline Tracing: FS-1/2.2 & Purpose: to test the GPIO pin's level setting to HIGH. \\ \midrule
			Precondition                                                       & The GPIO's necessary files are available.              \\
			Input                                                              & Set the GPIO's level to HIGH.                         \\
			Expected result                                                    & The "value" file has been modified with value "1"     \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\paragraph{Occupancy detection (FS-2) test cases} Occupancy detection components cannot be easily separated into subcomponents for testing purpose, because the communication between their parts is based on a serial port connection. There is no fake serial port connection  available on the market for windows operating system so we must test them together with real hardware connection or refactor our implementation.

\begin{table}[H]
	\caption{Test case 2-1}
	\label{table:TCase-FS2-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 2-1 & Purpose: to test the detection of segment occupancy (the train power consumption) through section occupancy query, when the specific segment is free\newline Priority: above middle \newline Tracing: (FS-2/1.0) \\ \midrule
			Precondition      & S88 serial port connection and available Arduino hardware element                                                                                                                                                \\
			Input             & Unclosed circuit between the specific segment's hardware elements elements                                                                                                                                       \\
			Expected result   & Occupancy components have queried free occupancy state                                                                                                                                                           \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\todo[inline]{specific segment is enough? or should I say something like segment S13}
\begin{table}[H]
	\caption{Test case 2-2}
	\label{table:TCase-FS2-2}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 2-1 & Purpose: to test detection of occupancy components, when the specific segment is occupied \newline Priority: above middle \newline Tracing: (FS-2/1.1) \\ \midrule
			Precondition      & S88 serial port connection and available Arduino hardware element                                                                                      \\
			Input             & Closed circuit between the specific segment's hardware elements                                                                                        \\
			Expected result   & Occupancy components have queried occupied occupancy state                                                                                             \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\paragraph{Track element controller (FS-3)  test cases} This component can further be divided into segment and turnout controllers. In this test plan, it does not detailed into further test cases for the specific controllers, because all the functional responsibility can be tested separately for each of them.

\begin{table}[H]
	\caption{Test case 3-1}
	\label{table:TCase-FS3-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 3-1 & Purpose: to test the track element controller's segment state setting as enabled \newline Priority: above middle \newline Tracing: (FS-3/1.0) \\ \midrule
			Precondition      & Observable GPIO components                                                                                                                    \\
			Input             & Call the track element controller set segment state function with enabled parameter                                                           \\
			Expected result   & All GPIO levels are in "HIGH" state, which are related to the specific segment                                                                \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{Test case 3-2}
	\label{table:TCase-FS3-2}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 3-2 & Purpose: to test the track element controller's segment state setting as disabled\newline Priority: above middle \newline Tracing: (FS-3/1.1) \\ \midrule
			Precondition      & Observable GPIO components                                                                                                                    \\
			Input             & Call the track element controller set segment state function with disabled parameter                                                          \\
			Expected result   & All GPIO levels are in "LOW" state, which are related to the specific segment                                                                 \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\begin{table}[H]
	\caption{Test case 3-3}
	\label{table:TCase-FS3-3}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 3-3 & Purpose: to test the track element controller's turnout changing to straight state\newline Priority: above middle \newline Tracing: (FS-3/2.0) \\ \midrule
			Precondition      & Observable GPIO components                                                                                                                     \\
			Input             & Call the track element controller set turnout state function with straight parameter                                                           \\
			Expected result   & The GPIO, which is controlling the straight branch, sent an impulse sign (inverting the current level twice with a specific time shift)     \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{Test case 3-4}
	\label{table:TCase-FS3-4}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 3-4 & Purpose: to test the track element controller's turnout changing to divergent state\newline Priority: above middle \newline Tracing: (FS-3/2.1) \\ \midrule
			Precondition      & Observable GPIO components                                                                                                                      \\
			Input             & Call the track element controller set turnout state function with divergent parameter                                                           \\
			Expected result   & The GPIO, which is controlling the divergent branch, sent an impulse sign (inverting the current level twice with a specific time shift)        \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\paragraph{Safety logic (FS-4) test cases} The following test cases are related to System level safety logic feature set.
\todo[inline]{extend it with figures?}
\begin{table}[H]
	\caption{Test case 4-1}
	\label{table:TCase-FS4-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 4-1 & Purpose: to test the safety logic awareness, when a train is moving on a path where the next section in the direction already occupied by an other train \newline Priority: high \newline Tracing: (FS-4/1.0) \\ \midrule
			Precondition      & None                                                                                                                                                                                                          \\
			Input             & Insert a train to a specific segment and move an other train to the adjacent segment                                                                                                                          \\
			Expected result   & Safety Logic sent a segment disable command with the id of the specific segment                                                                                                                               \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 


\begin{table}[H]
	\caption{Test case 4-2}
	\label{table:TCase-FS4-2}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 4-2 & Purpose: to test the safety logic awareness, when a train is moving and the 2nd section the path is already occupied by an other train \newline Priority: high \newline Tracing: (FS-4/1.0-1) \\ \midrule
			Precondition      & None                                                                                                                                                                                             \\
			Input             & Insert a train to a specific segment and move an other train there from a 2 distance away segment                                                                                                \\
			Expected result   & Safety Logic sent a segment disable command with the id of the specific segment                                                                                                                  \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\begin{table}[H]
	\caption{Test case 4-3}
	\label{table:TCase-FS4-3}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 4-2 & Purpose: to test the safety logic awareness, when a train is moving and the 3rd section in the path is already occupied by an other train \newline Priority: high \newline Tracing: (FS-4/1.0-2) \\ \midrule
			Precondition      & None                                                                                                                                                                                             \\
			Input             & Insert a train to a specific segment and move an other train there from a 3 distance away segment                                                                                                \\
			Expected result   & Safety Logic sent a segment disable command with the id of the specific segment                                                                                                                  \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\begin{table}[H]
	\caption{Test case 4-4}
	\label{table:TCase-FS4-4}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 4-4 & Purpose: to test the safety logic awareness, when a train is going through a turnout from top to straight, but the turnout is in divergent state \newline Priority: high \newline Tracing: (FS-4/2.0-1) \\ \midrule
			Precondition      & Set the specific turnout into divergent state                                                                                                                                                           \\
			Input             & Set a train to go through the specific turnout from top branch to straight branch                                                                                                                       \\
			Expected result   & Safety Logic sent a turnout disable command with the id of the specific turnout                                                                                                                         \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 



\begin{table}[H]
	\caption{Test case 4-5}
	\label{table:TCase-FS4-5}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Test case ID: 4-5 & Purpose: to test the safety logic awareness, when a train is going through a turnout from top to divergent, but the turnout is in straight state \newline Priority: high \newline Tracing: (FS-4/2.0-2) \\ \midrule
			Precondition      & Set the specific turnout into straight state                                                                                                                                                            \\
			Input             & Set a train to go through the specific turnout from top branch to divergent branch                                                                                                                      \\
			Expected result   & Safety Logic sent a turnout disable command with the id of the specific turnout                                                                                                                         \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\paragraph{Dashboard (FS-5) test cases} The following test cases are Dashboard feature set related items. This component can control and visualize the current track element states, consequently the unit test cases are checking the control network messages.
\begin{table}[H]
	\caption{Test case 5-1}
	\label{table:TCase-FS5-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 5-1 \newline Priority: am \newline Tracing: FS-5/1.0 & Purpose: to test the dashboard's set all turnout to straight functionality                   \\ \midrule
			Precondition                                                                   & All turnout must be in divergent state                                                       \\
			Input                                                                          & Simulate a button press to the change all turnout direction function                         \\
			Expected result                                                                & Message have been prepared to send with straight and a turnout id parameter for all turnouts \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{Test case 5-2}
	\label{table:TCase-FS5-2}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 5-2 \newline Priority: am \newline Tracing: FS-5/1.1 & Purpose: to test the dashboard's set all turnout to divergent functionality                   \\ \midrule
			Precondition                                                                   & All turnout must be in straight state                                                         \\
			Input                                                                          & Simulate a button press to the change all turnout direction function                          \\
			Expected result                                                                & Message have been prepared to send with divergent and a turnout id parameter for all turnouts \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{Test case 5-3}
	\label{table:TCase-FS5-3}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 5-3 \newline Priority: am \newline Tracing: FS-5/1.2 & Purpose: to test the dashboard's set all segment to enabled functionality                 \\ \midrule
			Precondition                                                                   & None                                                                                      \\
			Input                                                                          & Simulate a button press to the set all segments to enabled state function                 \\
			Expected result                                                                & Segment command message have been prepared to send with enable parameter for all segments \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{Test case 5-4}
	\label{table:TCase-FS5-4}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 5-4 \newline Priority: am \newline Tracing: FS-5/1.2 & Purpose: to test the dashboard's set all segment to disabled functionality                 \\ \midrule
			Precondition                                                                   & None                                                                                       \\
			Input                                                                          & Simulate a button press to the set all segments to disabled state function                 \\
			Expected result                                                                & Segment command message have been prepared to send with disable parameter for all segments \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}


\begin{table}[H]
	\caption{Test case 5-5}
	\label{table:TCase-FS5-5}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 5-5 \newline Priority: am \newline Tracing: FS-5/2.0 & Purpose: to test the dashboard's set turnout to straight functionality                         \\ \midrule
			Precondition                                                                   & A specific turnout must be in divergent state                                             \\
			Input                                                                          & Simulate a button press to the specific turnout                                                \\
			Expected result                                                                & Turnout command message have been prepared to send with straight and with turnout id parameter \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{Test case 5-6}
	\label{table:TCase-FS5-6}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 5-6 \newline Priority: am \newline Tracing: FS-5/2.1 & Purpose: to test the dashboard's set turnout to divergent functionality                         \\ \midrule
			Precondition                                                                   & A specific turnout must be in straight state                                                    \\
			Input                                                                          & Simulate a button press to the specific turnout                                                 \\
			Expected result                                                                & Turnout command message have been prepared to send with divergent and with turnout id parameter \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{Test case 5-7}
	\label{table:TCase-FS5-7}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 5-7 \newline Priority: am \newline Tracing: FS-5/2.2 & Purpose: to test the dashboard's functionality of enable a specific segment             \\ \midrule
			Precondition                                                                   & None                                                                                    \\
			Input                                                                          & Simulate a button press to the specific segment                                         \\
			Expected result                                                                & Segment command message have been prepared to send with enable and segment id parameter \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{Test case 5-8}
	\label{table:TCase-FS5-8}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 5-8 \newline Priority: am \newline Tracing: FS-5/2.3 & Purpose: to test the dashboard's functionality of disable a specific segment             \\ \midrule
			Precondition                                                                   & None                                                                                     \\
			Input                                                                          & Simulate a button press to the specific segment                                          \\
			Expected result                                                                & Segment command message have been prepared to send with disable and segment id parameter \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}







\noindent\subsubsection{Test Procedure Specification}
In this unit scoped test plan, each feature set is derived from a software component in the railway system. Regarding this property each test set can involve a group of test cases which are related for that feature set. A unit test must be a fast, isolated, repeatable, self-validated execution, therefore test set's ordering should not influence the test results. Consequently we can execute them independently but we can also give an order as the test cases ordered in the Test case definition section (described in \autoref{section:UnitTestCases}) and one test procedure can contain one test set. 
\todo[inline]{Create tables for 5 test procedures, which lists the test cases grouped by components -> table with columns: test case name | actual results | test result?} 

\subsection{Test Design Specification for Integration Test Plan}

\paragraph{Purpose:} The aim of the following test specification is to give instructions about setting up and executing integration tests. These tests will verify two or more component's behavior together.
\paragraph{References:} The railway system related requirements can be found in \autoref{section:REQ}.

\subsubsection{Feature Sets} 
\begin{table}[!h]
	\caption{Feature sets}
	\label{table:Feature-Sets-integration}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 1.0 \textwidth
			{  X[0.7,c] X[1.5, c] X[3.0, c] X[0.7,c] X[c] X[2.0,c] }
			\toprule
			       \multicolumn{2}{c}{Feature Set}        & Scope                                                                                                        & Priority & Approach & Traceability                                                                                                  \\ \midrule
			ID    & Name                                  &                                                                                                              &          &          &                                                                                                               \\ \midrule
			FSI-1 & Occupancy message                     & To test the occupancy network messages sent out by the occupancy components                                  & Am       &          & \ref{req:OCQ-1}, \ref{req:OCQ-2}, \ref{req:SOQ}                                                               \\
			FSI-2 & Track element controller instructions & To test Track element controller and GPIO handling functionalities, manipulating by network command messages & Am       &          & \ref{req:TEC-1} \ref{req:TEC-2} \ref{req:GPIO}                                                                \\
			FSI-3 & Safety logic interaction              & To test the occupancy detections with safety logic reactions and their network command messages              & H        &          & \ref{req:SL-1} \ref{req:SL-2}  \ref{req:SL-3}  \ref{req:SL-4} \ref{req:OCQ-1}, \ref{req:OCQ-2}, \ref{req:SOQ} \\
			FSI-4 & Safety logic intervention             & To test the safety logic intervention through Track element controller by network command messages           & H        &          & \ref{req:SL-1} \ref{req:SL-2}  \ref{req:SL-3}  \ref{req:SL-4} \ref{req:TEC-1} \ref{req:TEC-2}                 \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\todo[inline]{Do I need FSI-3 and FSI-4 feature sets? (both?)}

\subsubsection{Test Conditions and coverage items}
The test condition and coverage items for the integration tests can be defined with the same aspects as the specific component in the unit test plan.
The following enumeration is showing a mapping between the integration and unit test feature sets.
\begin{enumerate}
	\item Occupancy message (FSI-1) - Occupancy detection (FS-3) (\ref{table:TC-FS-2})
	\item Track element controller instructions (FSI-2) - Track element controller(\ref{table:TC-FS-3})
	\item Safety Logic interaction (FSI-3) - Occupancy detection (FS-3) (\ref{table:TC-FS-2})
	\item Safety logic intervention (FSI-4) - Safety Logic (FS-4) (\ref{table:TC-FS-4})
\end{enumerate}
\todo[inline]{Make sure this enumeration isn't cutted into 2 half}
\todo[inline]{do we lost now traceability from test cases to test condition and coverage items ?} 

\subsubsection{Test cases}
\paragraph{Occupancy message (FSI-1) text cases} The occupancy related test cases are verifying the network message sent by the Occupancy Query software element.
\begin{table}[H]
	\caption{Integration test case 1-1}
	\label{table:TCase-FSI1-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 1-1 \newline Priority: am \newline Tracing: FS-2/1.0 & Purpose: to test the detection of segment occupancy when a segment is free and to verify the propagated network occupancy message \\ \midrule
			Precondition                                                                   & There must be an MQTT server connection available and an connected with serial port                                               \\
			Input                                                                          & Unclosed circuit between the specific segment's hardware elements                                                                 \\
			Expected result                                                                & A new segment occupancy message must be send to the network with free segment state  and the specific segment id                          \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\begin{table}[H]
	\caption{Integration test case 1-2}
	\label{table:TCase-FSI1-2}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 1-2 \newline Priority: am \newline Tracing: FS-2/1.1 & Purpose: to test the detection of segment occupancy when a segment is occupied and verify the network occupancy message \\ \midrule
			Precondition                                                                   & There must be an MQTT server connection available and an Arduino with S88 serial port connected                         \\
			Input                                                                          & Closed circuit between the specific segment's hardware elements                                                         \\
			Expected result                                                                & A new segment occupancy message must be send to the network with occupied segment state  and the specific segment id              \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\paragraph{Track element controller instructions (FSI-2) test cases}\label{p:TEC-ITC} The main focus in the following test cases is to send segment and turnout command messages to the Track element controller. We can further observer the file output for the supervised GPIOs.
\todo[inline]{should these testcases be concrete for a segment? }
\begin{table}[H]
	\caption{Integration test case 2-1}
	\label{table:TCase-FSI2-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 2-1 \newline Priority: am \newline Tracing: FS-3/1.0 & Purpose: to test the track element controller, that it enables its supervised segment's state                                   \\ \midrule
			Precondition                                                                   & There must be an MQTT server connection available                                                                               \\
			Input                                                                          & Send a SegmentCommand message with enabled state and a segment id which is supervised by the track element controller component \\
			Expected result                                                                & All related GPIO (pru and app) has the writer with value "1" and targetFile "value"                                             \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\begin{table}[H]
	\caption{Integration test case 2-2}
	\label{table:TCase-FSI2-2}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 2-2 \newline Priority: am \newline Tracing: FS-3/1.1 & Purpose: to test the track element controller, that it disables its supervised segment's state                                  \\ \midrule
			Precondition                                                                   & There must be an MQTT server connection available                                                                               \\
			Input                                                                          & Send a SegmentCommand message with disable state and a segment id which is supervised by the track element controller component \\
			Expected result                                                                & All related GPIO (pru and app) has the writer with value "0" and targetFile "value"                                             \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\begin{table}[H]
	\caption{Integration test case 2-3}
	\label{table:TCase-FSI2-3}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 2-3 \newline Priority: am \newline Tracing: FS-3/2.0 & Purpose: to test the track element controller, that it sets its turnout to straight state                                                                         \\ \midrule
			Precondition                                                                   & There must be an MQTT server connection available                                                                                                                 \\
			Input                                                                          & Send a TurnoutCommand message with straight state and the turnout id which is controller by the track element controller component                                \\
			Expected result                                                                & Verify that the straight GPIO handle of the specific turnout have written with values: "1", "0", "1" in this specific order and the "value" targetfile parameter \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\begin{table}[H]
	\caption{Integration test case 2-4}
	\label{table:TCase-FSI2-4}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			Integration test case ID: 2-4 \newline Priority: am \newline Tracing: FS-3/2.1 & Purpose: to test the track element controller, that it sets its turnout to divergent state                                                                 \\ \midrule
			Precondition                                                                   & There must be an MQTT server connection available                                                                                                          \\
			Input                                                                          & Send a TurnoutCommand message with divergent state and the turnout id which is controller by the track element controller component                        \\
			Expected result                                                                & Verify that the divergent GPIO handle of the specific turnout have written with values: "1", "0", "1" in this specific order and to the "value" targetfile \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\subsubsection{Test procedure} 
In the integration test plan all the FSI-1 feature set related test cases requires hardware components during test execution. Apart from that all other test cases are purely software component tests, therefore they can be executed separately.

\todo[inline]{table with columns: test case name | actual results | test result ?}


\subsection{Test Design Specification for System Test Plan}

\paragraph{Purpose:} The system test plan is describes a road map to verify the high-level requirements of the railway system.
\paragraph{References:} The related requirements are previously described in \autoref{section:REQ}.

\subsubsection{Feature Sets} 
%1) manual with dashboard: check segments and turnouts
%2) SL checks: change turnout so trains can collide, change turnout and cut it with a train

\begin{table}[!h]
	\caption{System feature sets}
	\label{table:Feature-Sets-System}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 1.0 \textwidth
			{  X[0.8, c] X[1.5, c] X[3.0, c] X[0.7,c] X[c] X[2.0,c] }
			\toprule
			        \multicolumn{2}{c}{Feature Set}         & Scope                                                        & Priority & Approach & Traceability                                                               \\ \midrule
			ID    & Name                                    &                                                              &          &          &                                                                            \\ \midrule
			FSS-1 & Track element availability verification & To test the railway system track element's proper operations & Am       &          & \ref{req:DB-1} \ref{req:DB-2} \ref{req:DB-3} \ref{req:DB-4} \ref{req:DB-5} \\
			FSS-2 & Safety logic verification               & To test the safety logic functionalities                     & H        &          & \ref{req:SL-1} \ref{req:SL-2} \ref{req:SL-3} \ref{req:SL-4}                \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 

\subsubsection{Test condition and coverage items}
From the previously described (\ref{table:Feature-Sets-System}) feature sets the test condition and coverage items can be derived, which are detailed in the following sections.
\paragraph{Track element availability verification (FSS-1)} The purpose of this test condition is to verify all segment and turnout availability with a fast functional test. 
\begin{table}[H]
	\caption{Train detection test conditions}
	\label{table:TC-FSS-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[c] X[c] X[c] }
			\toprule
			Test condition & Scope                      & Section type \\ \midrule
			FSS-1/1        & \centeredDoubleRow{2}{All} & Turnout      \\
			FSS-1/2        &                            & Segment      \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table} 
\paragraph{Safety logic verification (FSS-2)} The system level safety logic verification the test conditions are the same it was previously shown for unit tests in \autoref{table:TC-FS-4}. To summarize that, the conditions can be divided into turnout derail and train collision scenarios. 

\subsubsection{Test cases}
\paragraph{Track element availability verification (FSS-1)} The following test cases will use network segment and turnout command messages as previously described in \autoref{p:TEC-ITC} integration test case. 
\begin{table}[H]
	\caption{System test case 1-1}
	\label{table:TCase-FSS1-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			System test case ID: 1-1 \newline Priority: am \newline Tracing: FS-6/1.0 & Purpose: to test all turnout controllability                                    \\ \midrule
			Precondition                                                              & None                                                                            \\
			Input                                                                     & Send a switch turnout command to all turnouts twice                                \\
			Expected result                                                           & All turnout state have been changed to straight from divergent and the other way \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{System test case 1-2}
	\label{table:TCase-FSS1-2}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			System test case ID: 1-2 \newline Priority: am \newline Tracing: FS-6/1.2 & Purpose: to test all segment controllability   \\ \midrule
			Precondition                                                              & None                                           \\
			Input                                                                     & Send a segment disable command to all segments \\
			Expected result                                                           & All segment have been disabled                 \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{System test case 1-3}
	\label{table:TCase-FSS1-3}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			System test case ID: 1-3 \newline Priority: am \newline Tracing: FS-6/1.2 & Purpose: to test all segment controllability  \\ \midrule
			Precondition                                                              & None                                          \\
			Input                                                                     & Send a segment enable command to all segments \\
			Expected result                                                           & All segment have been enabled                 \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}


\paragraph{Safety logic verification (FSS-2)} The below detailed safety logic test cases instead of checking the whole table, will just verify the safety logic decisions in the most problematic scenarios. 
\todo[inline]{Mention good figures about the layout here}
\begin{table}[H]
	\caption{System test case 2-1}
	\label{table:TCase-FSS2-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			System test case ID: 2-1 \newline Priority: am \newline Tracing: FS-6/1.2??? & Purpose: to test the safety logic for turnout derail scenario                                      \\ \midrule
			Precondition                                                                 & Turnout T5, T1 is in straight state and a train is on the segment S13                              \\
			Input                                                                        & Move the train to segment S15 from segment S13 through the path of S13, S8, T5, S11, T1, S15.      \\
			Expected result                                                              & Before T1 turnout the whole railway system is disabled by the safety logic to avoid turnout derail \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\begin{table}[H]
	\caption{System test case 2-2}
	\label{table:TCase-FSS2-2}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[0.4, c] X[c] }
			\toprule
			System test case ID: 2-2 \newline Priority: am \newline Tracing: FS-6/1.2??? & Purpose: to test the safety logic for train collision scenario                                                    \\ \midrule
			Precondition                                                                 & Turnout T5 is in straight state, turnout T1 is in divergent state and 2 trains are on the segments of S13 and S15 \\
			Input                                                                        & Move the first train to segment S15 from segment S13 through the path of S13, S8, T5, S11, T1, S15.               \\
			Expected result                                                              & Before segment S15 the whole railway system is disabled by the safety logic to avoid train collision              \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\subsubsection{Test procedure} 
%1) STC 1-1, 1-2, 1-3
%2) STC 2-1, 2-2
\paragraph{System test procedure for FSS-1} The following procedure is focusing on verifying the track element controller functionalities. 
\begin{enumerate}
	\item Objective: FSS-1
	\item Priority: high
	\item Start up: all the track element controllers should be started properly
	\item Stop and wrap up: all track element controllers on the components must be stopped
\end{enumerate}
\begin{table}[H]
	\caption{System test procedure for FSS-1}
	\label{table:SystemTestProcedure-1}
	\begin{center}
		\renewcommand{\arraystretch}{1.8}
		\begin{tabu} 
			to 0.9 \textwidth
			{  X[1.5, c] X[c] X[c] }
			\toprule
			Test case name           & Actual results & Test result \\ \midrule
			1-1: change all turnout  &                &             \\
			1-2: disable all segment &                &             \\
			1-3: enable all segment  &                &             \\ \bottomrule
		\end{tabu}
	\end{center}
\end{table}

\paragraph{System test procedure for FSS-2}  
\begin{enumerate}
	\item Objective: FSS-2
	\item Priority: high
	\item Start up: place 2 trains on the sections of S13 and S15
	\item Stop and wrap up: restart the disabled sections or the whole track
\end{enumerate}
\begin{table}[H]
\caption{System test procedure for FSS-2}
\label{table:SystemTestProcedure-2}
\begin{center}
	\renewcommand{\arraystretch}{1.8}
	\begin{tabu} 
		to 0.9 \textwidth
		{  X[1.5, c] X[c] X[c] }
		\toprule
		Test case name       & Actual results & Test result \\ \midrule
		2-1: turnout derail  &                &             \\
		2-2: train collision &                &             \\ \bottomrule
	\end{tabu}
\end{center}
\end{table}

\subsection{Test Status Report}
\todo[inline]{Describe Code coverage and test measures for GPIO Manager}

\todo[inline]{for all test plans should be created a test status report?}